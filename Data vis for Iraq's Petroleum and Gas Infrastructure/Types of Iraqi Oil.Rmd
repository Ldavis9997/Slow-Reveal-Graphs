---
title: "Types of Iraqi Oil"
author: "Lauryn Davis"
date: "7/10/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
library(tidyverse)
library(ggtext)
library(ggrepel)
library(grid)
library(ggforce)
library(showtext)
library(magick)

```

```{r, fig.height= 6, fig.width= 4}
picture <- image_graph(width = 340, height = 490)
annotation_custom2 <- 
function (grob, xmin = -Inf, xmax = 340, ymin = -Inf, ymax = 470, data) 
{
  layer(data = data, stat = StatIdentity, position = PositionIdentity, 
        geom = ggplot2:::GeomCustomAnn, 
        inherit.aes = TRUE, params = list(grob = grob, 
                                          xmin = xmin, xmax = xmax, 
                                          ymin = ymin, ymax = ymax))
}

#font_add(family="Open", regular=    "OpenSans-Bold.ttf")
showtext_auto()
type_levels <- c("Very Heavy","Light", "Medium", "Regular", "Heavy")
 pop_colors <- c("#010102" , "#1566ac","#ed1f02", "#e1eb00", "#8fa800" )
df<- tibble(
  type_levels = fct_rev(factor(type_levels, levels = type_levels)), # Convert to factor, then reverse the ordering with fct_rev.
  value = c(5,7,18,27,43), 
  pop_colors = c("#010102" , "#1566ac","#ed1f02", "#e1eb00", "#8fa800" )
  )
df2 <- df %>%
  mutate(csum = rev(cumsum(rev(value))), 
         pos = value/2 + lead(csum, 1),
         pos = if_else(is.na(pos), value/2, pos)
         )
bp <- ggplot(df, aes(x = "", y = rev(value), fill = type_levels)) +
  geom_bar(width = 1, stat = "identity", color = "black")
pie<- bp +
         coord_polar("y", start = 0) +  # Using ggtext + HTML syntax to color text
         # For some reason '\n' doesn't work here so I used <br> instead.
         labs(title = "<p><span style = 'font-size:19pt; color:#FFFFFF'><i>T</span><span style = 'font-size:14pt; color:#FFFFFF'>YPES</span><span style = 'font-size:19pt; color:#FFFFFF'> O</span><span style = 'font-size:14pt; color:#FFFFFF'>F</span><span style = 'font-size:19pt; color:#FFFFFF'> I</span><span style = 'font-size:14pt; color:#FFFFFF'>RAQI</span><span style = 'font-size:19pt; color:#FFFFFF'> O</span><span style = 'font-size:14pt; color:#FFFFFF'>IL<sup>a</sup></span></p>",
              subtitle = " ",
              y = "",
              x = "",
              caption ="<p><span style = 'font-size:11pt; color:#000000'><sup>a</sup> Iraq markets two crude blends: 60 percent</p><p><span style = 'font-size:11pt; color:#000000'>of exports is Basrah Light (34.4° API) and</p><p><span style = 'font-size:11pt; color:#000000'>40 percent is Kirkuk(37° API).</p><p><span style = 'font-size:11pt; color:#000000'><sup>b</sup> API gravity is a measure of crude oil density,</p><p><span style = 'font-size:11pt; color:#000000'>with higher numbers denoting lighter, more</p><p><span style = 'font-size:11pt; color:#000000'>valuable crude oil</p></span>") +
         theme_classic() +
         theme(axis.line=element_blank(),
               plot.margin =  unit(c(0,0,2,0), "cm"),
               plot.title= element_textbox_simple(family= "Open",size = 10, lineheight = 0, 
                                                  width = grid::unit(4.9, "in"), # fixed width
                                                  hjust = .5, # alignment of box relative to plot
                                                  linetype = 0, # turn on border
                                                  box.color = "black", # border color
                                                  fill = "#6D7166", # background fill color
                                                  r = grid::unit(0, "pt"), # radius for rounded corners
                                                  padding = margin(14, -1, 14, 24), # padding around text inside the box
                                                  margin = margin(0, 0, 80, 0)),
               axis.text.x = element_blank(),
               axis.text.y= element_blank(),
               axis.title.x = element_blank(),
               axis.title.y= element_blank(),
               legend.position = "none",
               plot.subtitle = element_markdown(hjust=-.5),
               plot.caption= element_markdown(hjust=38, vjust = 5, lineheight=1)) + scale_fill_manual(values=pop_colors)
pie
dev.off()

img <- image_draw(picture)
text(141, 136, "Very heavy", family = "Text", cex = .9, col = "black")+
  text(126, 147, "(20°)", family = "Text", cex = .9, col = "#0c64a4")+
  text(143, 147, substitute(paste(italic(" , 5"))), family = "Text", cex = .9, col = "black")+
  text(235, 158, "Heavy", family = "Text", cex = .9, col = "black")+
  text(277, 158, "(20°-26°),", family = "Text", cex = .9, col = "#0c64a4")+
  text(227, 168, substitute(paste(italic("43"))), family = "Text", cex = .9, col = "black")+
  text(48, 167, "Light", family = "Text", cex = .9, col = "black")+
  text(80, 167, "(38° +),", family = "Text", cex = .9, col = "#0c64a4")+
  text(104, 167, substitute(paste(italic("7"))), family = "Text", cex = .9, col = "black")+
  text(43, 200, "Medium", family = "Text", cex = .9, col = "black")+
  text(48, 215, "(27° -33°),", family = "Text", cex = .9, col = "#0c64a4")+
  text(30, 228, substitute(paste(italic("18"))), family = "Text", cex = .9, col = "black")+
  text(35, 326, "Regular", family = "Text", cex = .9, col = "black")+
  text(83, 326, "(34° -37°),", family = "Text", cex = .9, col = "#0c64a4")+
  text(23, 338, substitute(paste(italic("27"))), family = "Text", cex = .9, col = "black")+
  text(-1, 105, "Numbers in parenthesis are American\nPetrolium Institute (API) degrees gravity.", family = "Text", cex = .9, col = "#0c64a4", pos = 4)+
  text(202, 105, "b", family = "Text", cex = .6, col = "#0c64a4")+
  text(25, 75, substitute(paste(italic("Percent"))), family = "Text", cex = .9, col = "black")+
  
  segments(x0=8, x1=333, y0=65, y1=65, lwd = 1, lty = "solid")
  
  
  
  
  
  
dev.off()
image_write(img, path = here::here("Data vis for Iraq's Petroleum and Gas Infrastructure", "Picture1.png"), format = "png")
```
---
title: "Types of Iraqi Oil"
author: "Lauryn Davis"
date: "7/10/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
library(tidyverse)
library(ggtext)
library(ggrepel)
library(grid)
library(ggforce)
library(showtext)

```

```{r, fig.height= 6, fig.width= 4}
font_add(family="Open", regular= 	"OpenSans-Bold.ttf")
showtext_auto()

pop_colors = c("#010102" , "#1566ac","#ed1f02", "#e1eb00", "#8fa800" )
#black, blue, red, yellow, green
Label= c("Very heavy\n(20),5", "Light (38 +), 7", "Medium\n(27 -33),\n18", "Regular (34 -37),\n27", "Heavy (20 -26),\n43")

df<- data.frame(
  type_levels= c("Very Heavy","Light", "Medium", "Regular", "Heavy"),
  value= c(5,7,18,27,43), 
  Label= c("Very heavy\n(20),5", "Light (38 +), 7", "Medium\n(27 -33),\n18", "Regular (34 -37),\n27", "Heavy (20 -26),\n43"), 
  pop_colors = c("#010102" , "#1566ac","#ed1f02", "#e1eb00", "#8fa800" )
)


df<- data.frame(
  type_levels= c("Very Heavy","Light", "Medium", "Regular", "Heavy"),
  value= c(5,7,18,27,43), 
  Label= c("Very heavy\n(20°),5", "Light (38° +), 7", "Medium\n(27° -33°),\n18", "Regular (34° -37°),\n27", "Heavy (20° -26°),\n43"), 
  pop_colors = c("#010102" , "#1566ac","#ed1f02", "#e1eb00", "#8fa800" )
)
df2<- df%>%
  mutate(end = 2 * pi * cumsum(value)/sum(value),
          start = lag(end, default = 0),
          middle = 0.5 * (start + end),
          hjust = ifelse(middle > pi, 1, 0),
          vjust = ifelse(middle < pi/2 | middle > 3 * pi/2, 0, 1))

  
bp<- ggplot(df2, aes(x="", y=value, fill= reorder(type_levels, value)))+ 
  geom_bar(width=1, stat= "identity", color="black") + 
pie<- (bp+ coord_polar("y", start=0) +  # Using ggtext + HTML syntax to color text
  # For some reason '\n' doesn't work here so I used <br> instead.
  labs(title = "<p><span style = 'font-size:11pt; color:#000000'><i>Percent</span></p>",
       subtitle = "<p><span style = 'font-size:11pt; color:#0c64a4'>Numbers in Parenthesis are American</p><p><span style= 'font-size 11pt; color: #0c64a4'> Petroleum Institute (API) degrees gravity.<sup>b</sup></span></p>",
       y = "",
       x = "",
       caption ="<p><span style = 'font-size:10pt; color:#000000'><sup>a</sup>Iraq markets two crude blends: 60 percent</p><p><span style = 'font-size:10pt; color:#000000'>of exports is Basrah Light (34.4° API) and</p><p><span style = 'font-size:10pt; color:#000000'>40 percent is Kirkuk(37° API).</p><p><span style = 'font-size:10pt; color:#000000'><sup>b</sup>API gravity is a measure of crude oil density,</p><p><span style = 'font-size:10pt; color:#000000'>with higher numbers denoting lighter, more</p><p><span style = 'font-size:10pt; color:#000000'>valuable crude oil</p></span>")
+ 
  theme_classic()
+ theme(axis.line=element_blank(),
                                  axis.text.x = element_blank(),
                                  axis.text.y= element_blank(),
                                  axis.title.x = element_blank(),
                                  axis.title.y= element_blank(),
                                  legend.position = "none",
                         plot.title= element_textbox_simple(family= "Open",size = 8, lineheight = 1, 
      width = grid::unit(7.53, "in"), # fixed width
      hjust = .15, # alignment of box relative to plot
      linetype = 0, # turn on border
      box.color = "black", # border color
      fill = "#6D7166", # background fill color
      r = grid::unit(0, "pt"), # radius for rounded corners
      padding = margin(0, 5, 7, 10), # padding around text inside the box
      margin = margin(0, 0, 0, 0)),
                         plot.subtitle = element_markdown(),
        plot.caption= element_markdown(hjust=0))
+ scale_fill_manual(values= pop_colors))
pie 
  
  
```
```{r}
Product <- c("Heavy", "Regular", "Medium", "Light", "Very Heavy")
pop_colors <- c("#010102" , "#1566ac","#ed1f02", "#e1eb00", "#8fa800" )
Value <- c(43,27,18,7,5)

df <- data.frame(Product,Value)
df$Label <- paste(Product, paste(c("(20-26),\n43","\n(20),5","(38 +),7","\n(27-33),\n18","(34-37),\n27")), sep=" ")

library(ggplot2)

p <-  ggplot(df, aes(x = 1, y = Value, fill = Product)) + geom_bar(stat = "identity")
p <- p + coord_polar(theta = 'y') + theme_void() 
p <- p + geom_text(aes(label = Label),size=4, position = position_stack(vjust = 0.5))
p<- p + scale_fill_manual(values= pop_colors)

                  
df <- df %>% 
  mutate(end = 2 * pi * cumsum(Value)/sum(Value),
         start = lag(end, default = 0),
         middle = 0.5 * (start + end),
         hjust = ifelse(middle > pi, 1, 0),
         vjust = ifelse(middle < pi/2 | middle > 3 * pi/2, 0, 1))

library(ggforce) # for 'geom_arc_bar'
p<-ggplot(df) + 
  geom_arc_bar(aes(x0 = 0, y0 = 0, r0 = 0, r = 1,
                   start = start, end = end, fill = Product)) +
  geom_text(aes(x = 1.1* sin(middle), y = 1.1 * cos(middle), label = Label,
                hjust = hjust, vjust = vjust), size=4) +
  coord_fixed() +
  scale_x_continuous(limits = c(-2, 2),  # Adjust so labels are not cut off
                     name = "", breaks = NULL, labels = NULL) +
  scale_y_continuous(limits = c(-1.5, 1.5),    # Adjust so labels are not cut off
                     name = "", breaks = NULL, labels = NULL)
before_theme<- p + scale_fill_manual(values= c("#8fa800", "#1566ac", "#ed1f02", "#e1eb00", "#010102"))

before_theme+ theme_classic() +theme(
  legend.position= "none",
  axis.line= element_blank()
)

  
```



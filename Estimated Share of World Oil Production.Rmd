```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}


library(gridExtra)

library(tidyverse)
library(ggtext)
library(ggrepel)
library(grid)
library(ggforce)
library(showtext)
library(magick)
library(googlesheets4)
data<- read_sheet('https://docs.google.com/spreadsheets/d/1gANfa3d6Y4EGBuODZGbW4m6yHjCOSovfzkFLxvRhBrM/edit?usp=sharing')

data$region <- factor(data$region, levels = unique(data$region))


```
```{r}

picture <- image_graph(width = 661, height = 500)
annotation_custom2 <- 
function (grob, xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = 470, data) 
{
  layer(data = data, stat = StatIdentity, position = PositionIdentity, 
        geom = ggplot2:::GeomCustomAnn, 
        inherit.aes = TRUE, params = list(grob = grob, 
                                          xmin = xmin, xmax = xmax, 
                                          ymin = ymin, ymax = ymax))
}

font_add(family="Open", regular="OpenSans-Bold.ttf")
showtext_auto()
pop_colors<- c('#b6a6b8','#cecfdb','#b6a6b8','#cecfdb','#b6a6b8','#cecfdb','#b6a6b8','#cecfdb','#f3b343','#7ba539','#d8252e','#e6e154','#3e6dbe')
ggplot(data=data, aes(x=" ", y=rev(value), group=year, fill=rev(region))) +
         geom_bar(stat = "identity", color='black', size = .3) +
         coord_polar("y", start=0) + 
         facet_grid(.~ year) +theme_void()+ scale_fill_manual(values=pop_colors)+
  labs(caption= "Source: US Energy and Information Administration.")+
  theme(legend.position = "none",
        plot.margin =  unit(c(5,2.5,3.2,2.5), "cm"),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        panel.grid  = element_blank(),
        strip.text.x = element_blank(),
        panel.spacing = unit(8, "lines"),
        plot.title = element_textbox(vjust =125),
        plot.caption= element_text(vjust=-33, hjust = -.18, size = 11))
dev.off()
img <- image_draw(picture)
 polygon(c(0, 665, 665, 0), c(0, 0, 50, 50), border = "#6D7166", col = "#6D7166")+
   text(255, 25, "ESTIMATED SHARE OF WORLD OIL PRODUCTION", family = "Open", cex = 1.7, col = "white")+
text(30, 90, substitute(paste(bold('2000'))), family = "Text", cex = 1.1, col = "black")+
   text(370, 90, substitute(paste(bold('2010'))), family = "Text", cex = 1.1, col = "black")+
   segments(x0=15, x1=331, y0=100, y1=100, lwd = 1, lty = "solid")+
   segments(x0=355, x1=640, y0=100, y1=100, lwd = 1, lty = "solid")
dev.off()
image_write(img, path = here::here("Data vis for Iraq's Petroleum and Gas Infrastructure", "Key.png"), format = "png")

#ggsave('hi.pdf', height  = 4.35)

```
